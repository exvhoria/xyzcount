-- Dead Rails Auto Bond Farm Loadstring v3.1 (No Delta Check)
-- Для Delta Emulator (Android/iOS)

local function AutoFarm()
    -- Настройки
    local Settings = {
        FarmTime = 60 * 60, -- 1 час (в секундах)
        TargetBonds = 150,
        MoveDelay = 0.7,
        CollectKey = "E",
        Keys = {"W", "A", "S", "D"},
        AntiBan = true
    }

    -- ⚠️ БЕЗ ПРОВЕРКИ DELTA
    local start = os.time()
    local collected = 0

    local mem = delta and delta.memory or nil
    local kb = delta and delta.keyboard or nil

    local function FindBonds()
        local patterns = {
            "B8 ? ? ? ? F3 ? ? 45 ? 89 45",
            "8B ? ? ? ? ? 89 ? ? 8B ? ? 3B"
        }

        for _, pattern in ipairs(patterns) do
            if delta and delta.patterns then
                local addr = delta.patterns.find(pattern)
                if addr then return addr + 0x10 end
            end
        end
        return nil
    end

    local function Move()
        if not kb then return end
        local key = Settings.Keys[math.random(1, #Settings.Keys)]
        kb.press(key, math.random(300, 800))
    end

    local function Collect()
        if not kb then return end
        kb.press(Settings.CollectKey, 500)
        collected = collected + 1
        print("Собрано:", collected)
    end

    local bondAddr = FindBonds()
    if not bondAddr then
        print("⚠️ Адрес не найден! Используем базовый режим")
    end

    while true do
        if os.time() - start > Settings.FarmTime then break end
        if Settings.TargetBonds > 0 and collected >= Settings.TargetBonds then break end

        Move()

        if bondAddr and mem and mem.readInt(bondAddr) > collected then
            Collect()
        elseif math.random() > 0.6 then
            Collect()
        end

        if Settings.AntiBan and delta then
            delta.delay(math.random(800, 1500))
        else
            os.execute("sleep " .. Settings.MoveDelay) -- fallback if no delta
        end
    end

    print(string.format("Фарм завершен!\nСобрано: %d\nВремя: %d мин.",
        collected,
        (os.time() - start) / 60))
end

-- Запуск
AutoFarm()
